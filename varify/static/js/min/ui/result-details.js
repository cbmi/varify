define(["jquery","underscore","marionette","../lib/solvebio","../models","./variant"],function(e,t,n,r,i,s){var o=function(e){r.Dashboards.get("variantDetailDashboard")&&r.Dashboards.delete("variantDetailDashboard"),r.Dashboards.create("variantDetailDashboard","//solvebio-varify.s3.amazonaws.com/dashboards/dev/variant-detail.html","#solvebio-variant-detail").ready(function(n){var r=[{and:[["hg18_chromosome",e.variant.chr],["hg18_start__range",[e.variant.pos-1e3,e.variant.pos+1e3]]]}];e.variant.rsid&&r.push(["rsid",e.variant.rsid]);var i=[];t.each(e.variant.effects,function(e){e.hgvs_c&&e.transcript.transcript&&i.push(e.transcript.transcript+":"+e.hgvs_c)}),i.length>0&&r.push(["hgvs__in",i]),n.postMessage({header:{id:"[#"+e.sample.id+"]",subtitle:"in "+e.sample.project,title:e.sample.label,alt:e.variant.alt,ref:e.variant.ref,quality:e.quality,read_depth:e.raw_read_depth,hgvs:i,chr:e.variant.chr,pos:e.variant.pos},clinvar:{filters:[{or:r}]}})})},u=n.Layout.extend({className:"result-details",template:"varify/result-details",maxExpandableHeight:360,showLessText:"Show Less...",showMoreText:"Show More...",ui:{expandableRows:"[data-target=expandable-row]",expandableItems:".expandable-item",expandCollapseLinks:"[data-target=expand-collapse-link]",linkContainers:".expand-collapse-container"},regions:{summary:"[data-target=summary]",effects:"[data-target=effects]",phenotypes:"[data-target=phenotypes]",scores:"[data-target=prediction-scores]",cohorts:"[data-target=cohorts]",frequencies:"[data-target=frequencies]",articles:"[data-target=articles]",assessmentMetrics:"[data-target=assessment-metrics]"},events:{"click @ui.expandCollapseLinks":"toggleExpandedState"},initialize:function(){if(!(this.model=this.options.result))throw new Error("A valid result object must be supplied")},_checkForOverflow:function(){t.each(this.ui.expandableItems,function(t){var n,r=!1;for(var i=0;i<t.children.length;i++){n=t.children[i];if(n.offsetTop+n.offsetHeight>this.maxExpandableHeight){r=!0;break}}r?e(t).find(this.ui.linkContainers).show():e(t).find(this.ui.linkContainers).hide()},this)},toggleExpandedState:function(t){var n,r;n=e(t.target),r=n.closest(this.ui.expandableRows),n.text()===this.showMoreText?(r.find(this.ui.expandCollapseLinks).text(this.showLessText),r.css({height:"auto",overflow:"visible"})):(r.find(this.ui.expandCollapseLinks).text(this.showMoreText),r.css({height:this.maxExpandableHeight,overflow:"hidden"}))},onDomRefresh:function(){this._checkForOverflow();var t=this.model.attributes;r.getAccessToken()?o(t):r.disabled||e.getJSON("/api/solvebio/oauth2/token",function(e){e.access_token?(r.setAccessToken(e.access_token),o(t)):r.disabled=!0})},onRender:function(){var e=new i.Variant(this.model.get("variant"));this.summary.show(new s.Summary({model:this.model})),this.effects.show(new s.Effects({collection:e.effects})),this.phenotypes.show(new s.Phenotypes({collection:e.phenotypes})),this.scores.show(new s.PredictionScores({model:e})),this.cohorts.show(new s.Cohorts({collection:e.cohorts})),this.frequencies.show(new s.Frequencies({model:e})),this.articles.show(new s.Articles({collection:e.articles})),this.assessmentMetrics.show(new s.AssessmentMetrics({variantId:e.id})),this.bindUIElements(),this.ui.expandableRows.css("height",""+this.maxExpandableHeight+"px").css("overflow","hidden"),this.ui.expandCollapseLinks.text(this.showMoreText)}});return{ResultDetails:u}})