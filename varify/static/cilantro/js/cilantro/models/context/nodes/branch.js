var __hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var n in e)__hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},__slice=[].slice;define(["underscore","backbone","./base"],function(t,e,i){var n,s;return s=function(e){function n(t,e){n.__super__.constructor.call(this,t,e),this.parent=null!=e?e.parent:void 0}return __extends(n,e),n.prototype.model=function(t,e){return i.ContextNodeModel.create(t,e)},n.prototype.get=function(e){return"number"==typeof e||null!=e.id?n.__super__.get.call(this,e):(e=e instanceof i.ContextNodeModel?e.identity():t.pick(e,this.parent.identKeys),this.find(e))},n.prototype.set=function(e,s){var o,r,a;if(null==e)return n.__super__.set.call(this,null,s);for(t.isArray(e)||(e=[e]),r=0,a=e.length;a>r;r++)if(o=e[r],o===this.parent)throw new i.ContextNodeError("Cannot add self as child");return n.__super__.set.call(this,e,s)},n.prototype.find=function(t,e){var i,n,s,o,r;for(r=this.models,s=0,o=r.length;o>s;s++)if(i=r[s],n=i.find(t,e))return n},n}(e.Collection),n=function(e){function i(){var t=this;this.children=new s(null,{parent:this}),this.on("change:children",function(t,e,i){return this.children.set(e,i)}),this.on("clear",function(){var t,e,i,n,s;for(n=this.children.models,s=[],e=0,i=n.length;i>e;e++)t=n[e],s.push(t.trigger("clear"));return s}),this.children.on("change",function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],t.set("children",t.children.toJSON(),{silent:!0}),t.trigger.apply(t,["change"].concat(__slice.call(e)))}),i.__super__.constructor.apply(this,arguments)}return __extends(i,e),i.prototype.type="branch",i.prototype.defaults=function(){return{type:"and",children:[]}},i.prototype.toJSON=function(t){var e,n,s,o,r,a;for(s=[],a=this.children.models,o=0,r=a.length;r>o;o++)n=a[o],n.isValid(t)&&(e=n.toJSON(t))&&s.push(e);return s.length?((e=i.__super__.toJSON.apply(this,arguments)).children=s,e):void 0},i.prototype._validate=function(e,i){var n;return i.validate?((!e||t.isEmpty(e))&&(e=this.toJSON(i)),e=t.extend({},e),(n=this.validationError=this.validate(e,i)||null)?(this.trigger("invalid",this,n,t.extend(i,{validationError:n})),!1):!0):!0},i.prototype.validate=function(t){return"and"!==t.type&&"or"!==t.type?"Not a valid branch type":t.children.length?void 0:"No children present"},i.prototype.define=function(e,i,n){var s,o,r,a,h;for(i&&t.isArray(i)||(n=i,i=[]),n=t.extend({manager:this.manager,identKeys:this.identKeys},n),r=this,a=0,h=i.length;h>a;a++){if(o=i[a],(s=r.find(o))||(r.children.add(o,{type:"branch"}),s=r.children.find(o)),"branch"!==s.type)throw new Error("Cannot define node in non-branch");r=s}return r.children.add(e,n),r.find(t.pick(e,n.identKeys))},i.prototype.find=function(t,e){var n;return(n=i.__super__.find.call(this,t,e))?n:this.children.find(t,e)},i.prototype.clear=function(t){null==t&&(t={}),this.children.each(function(e){return e.clear(t)}),t.reset&&this.children.reset()},i}(i.ContextNodeModel),{BranchNodeModel:n}});
//@ sourceMappingURL=branch.js.map